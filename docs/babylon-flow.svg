<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="661px" preserveAspectRatio="none" style="width:854px;height:661px;background:#FFFFFF;" version="1.1" viewBox="0 0 854 661" width="854px" zoomAndPan="magnify"><defs><filter height="300%" id="f2zy8x9mram0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f2zy8x9mram0)" height="425.502" style="stroke:#000000;stroke-width:2.0;" width="763" x="77.5" y="134.7988"/><rect fill="#FFFFFF" filter="url(#f2zy8x9mram0)" height="293.2598" style="stroke:#000000;stroke-width:2.0;" width="743" x="87.5" y="260.041"/><rect fill="#FFFFFF" filter="url(#f2zy8x9mram0)" height="149.5078" style="stroke:#000000;stroke-width:2.0;" width="723" x="97.5" y="295.2617"/><rect fill="#FFFFFF" height="73.5762" style="stroke:none;stroke-width:1.0;" width="723" x="97.5" y="371.1934"/><rect fill="#FFFFFF" height="57.2656" style="stroke:none;stroke-width:1.0;" width="743" x="87.5" y="451.7695"/><rect fill="#FFFFFF" height="44.2656" style="stroke:none;stroke-width:1.0;" width="743" x="87.5" y="509.0352"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="42" x2="42" y1="88.4883" y2="577.3008"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="181.5" x2="181.5" y1="88.4883" y2="577.3008"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="432" x2="432" y1="88.4883" y2="577.3008"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="783.5" x2="783.5" y1="88.4883" y2="577.3008"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="5" y="85.5352">developer</text><ellipse cx="42" cy="15" fill="#FEFECE" filter="url(#f2zy8x9mram0)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M42,23 L42,50 M29,31 L55,31 M42,50 L29,65 M42,50 L55,65 " fill="none" filter="url(#f2zy8x9mram0)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="5" y="589.8359">developer</text><ellipse cx="42" cy="602.7891" fill="#FEFECE" filter="url(#f2zy8x9mram0)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M42,610.7891 L42,637.7891 M29,618.7891 L55,618.7891 M42,637.7891 L29,652.7891 M42,637.7891 L55,652.7891 " fill="none" filter="url(#f2zy8x9mram0)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f2zy8x9mram0)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="145" x="107.5" y="36.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="114.5" y="57.0469">Kubernetes Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="132" y="73.5352">(e.g. dev-gcp)</text><rect fill="#FEFECE" filter="url(#f2zy8x9mram0)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="145" x="107.5" y="576.3008"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="114.5" y="596.8359">Kubernetes Cluster</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="132" y="613.3242">(e.g. dev-gcp)</text><rect fill="#FEFECE" filter="url(#f2zy8x9mram0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="68" x="396" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="403" y="73.5352">Babylon</text><rect fill="#FEFECE" filter="url(#f2zy8x9mram0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="68" x="396" y="576.3008"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="403" y="596.8359">Babylon</text><rect fill="#FEFECE" filter="url(#f2zy8x9mram0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="49" x="757.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="764.5" y="73.5352">Slack</text><rect fill="#FEFECE" filter="url(#f2zy8x9mram0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="49" x="757.5" y="576.3008"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="764.5" y="596.8359">Slack</text><polygon fill="#A80036" points="170,115.7988,180,119.7988,170,123.7988,174,119.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42" x2="176" y1="119.7988" y2="119.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="49" y="115.0566">deploy application</text><path d="M77.5,134.7988 L151.5,134.7988 L151.5,141.7988 L141.5,151.7988 L77.5,151.7988 L77.5,134.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="425.502" style="stroke:#000000;stroke-width:2.0;" width="763" x="77.5" y="134.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="92.5" y="148.3672">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174" x="166.5" y="147.4336">[Repeats every X (default: 60s)]</text><polygon fill="#A80036" points="193,169.4199,183,173.4199,193,177.4199,189,173.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="187" x2="431" y1="173.4199" y2="173.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="199" y="168.6777">GET "Deployments"</text><polygon fill="#A80036" points="420,198.7305,430,202.7305,420,206.7305,424,202.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="182" x2="426" y1="202.7305" y2="202.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="189" y="197.9883">Deployments</text><line style="stroke:#A80036;stroke-width:1.0;" x1="432" x2="474" y1="232.041" y2="232.041"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474" x2="474" y1="232.041" y2="245.041"/><line style="stroke:#A80036;stroke-width:1.0;" x1="433" x2="474" y1="245.041" y2="245.041"/><polygon fill="#A80036" points="443,241.041,433,245.041,443,249.041,439,245.041" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338" x="439" y="227.2988">filter(deployment.namespace in allowed_namespaces)</text><path d="M87.5,260.041 L149.5,260.041 L149.5,267.041 L139.5,277.041 L87.5,277.041 L87.5,260.041 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="293.2598" style="stroke:#000000;stroke-width:2.0;" width="743" x="87.5" y="260.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="102.5" y="273.6094">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="368" x="164.5" y="272.6758">[deployment.annotations.firstDetectedAsFailing &gt; Y (default: 24h)</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="411" x="168.5" y="285.6309">and deployment.annotations.LastChangeCause != Rolled back by Babylon]</text><path d="M97.5,295.2617 L159.5,295.2617 L159.5,302.2617 L149.5,312.2617 L97.5,312.2617 L97.5,295.2617 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="149.5078" style="stroke:#000000;stroke-width:2.0;" width="723" x="97.5" y="295.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="112.5" y="308.8301">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="281" x="174.5" y="307.8965">[exists running replicaset from previous revision]</text><polygon fill="#A80036" points="193,329.8828,183,333.8828,193,337.8828,189,333.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="187" x2="431" y1="333.8828" y2="333.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="199" y="329.1406">abort rollout of failing deployment</text><polygon fill="#A80036" points="772,359.1934,782,363.1934,772,367.1934,776,363.1934" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="432" x2="778" y1="363.1934" y2="363.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="439" y="358.4512">abort-rollout deployment</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="97.5" x2="820.5" y1="372.1934" y2="372.1934"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157" x="102.5" y="382.8281">[no abort-rollout candidate]</text><polygon fill="#A80036" points="193,403.459,183,407.459,193,411.459,189,407.459" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="187" x2="431" y1="407.459" y2="407.459"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="199" y="402.7168">downscale deployment to 0 replicas</text><polygon fill="#A80036" points="772,432.7695,782,436.7695,772,440.7695,776,436.7695" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="432" x2="778" y1="436.7695" y2="436.7695"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="439" y="432.0273">downscaled deployment</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="87.5" x2="830.5" y1="452.7695" y2="452.7695"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="198" x="92.5" y="463.4043">[deployment.age &lt; Z (default: 24h)]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="432" x2="474" y1="488.0352" y2="488.0352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474" x2="474" y1="488.0352" y2="501.0352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="433" x2="474" y1="501.0352" y2="501.0352"/><polygon fill="#A80036" points="443,497.0352,433,501.0352,443,505.0352,439,501.0352" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="439" y="483.293">skip</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="87.5" x2="830.5" y1="510.0352" y2="510.0352"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119" x="92.5" y="520.6699">[deployment.age &gt; Z]</text><polygon fill="#A80036" points="772,541.3008,782,545.3008,772,549.3008,776,545.3008" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="432" x2="778" y1="545.3008" y2="545.3008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="439" y="540.5586">alert team of failing deployment</text><!--MD5=[1e67d78c315b33ec79305048690f738e]
@startuml babylon-flow 
actor developer as developer
participant k8s as "Kubernetes Cluster\n(e.g. dev-gcp)"
participant babylon as "Babylon"
participant alertmanager as "Slack"

developer -> k8s: deploy application
loop Repeats every X (default: 60s)
babylon -> k8s: GET "Deployments"
return Deployments
babylon -> babylon: filter(deployment.namespace in allowed_namespaces)

alt deployment.annotations.firstDetectedAsFailing > Y (default: 24h) \n and deployment.annotations.LastChangeCause != Rolled back by Babylon

    alt exists running replicaset from previous revision
        
        babylon -> k8s: abort rollout of failing deployment
        babylon -> alertmanager: abort-rollout deployment

    else no abort-rollout candidate

        babylon -> k8s: downscale deployment to 0 replicas
        babylon -> alertmanager: downscaled deployment

    end

else deployment.age < Z (default: 24h)
    
    babylon -> babylon: skip

else deployment.age > Z

    babylon -> alertmanager: alert team of failing deployment
end

end
@enduml

PlantUML version 1.2021.9(Sun Jul 25 12:13:56 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: NO
--></g></svg>